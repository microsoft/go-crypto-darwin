# Copyright (c) Microsoft Corporation.
# Licensed under the MIT License.

on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - "**/*.swift"
      - ".github/workflows/build-swift.yml"
      - "gen-swift-bindings.sh"

name: Build Swift
jobs:
create-pr:
  runs-on: ubuntu-latest
  steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Create a new branch and commit changes
      run: |
        # Configure git for the action
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"

        # Create a new branch
        git checkout -b update-readme

        # Example change: Append a line to README.md (adjust as needed)
        echo "Update made by GitHub Actions" >> README.md

        # Stage and commit changes
        git add README.md
        git commit -m "Update README via GitHub Actions"

        # Push the new branch to the repository
        git push origin update-readme

    - name: Create Pull Request via GitHub API
      run: |
        curl -X POST \
          -H "Accept: application/vnd.github.v3+json" \
          -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          https://api.github.com/repos/${{ github.repository }}/pulls \
          -d '{
                "title": "Automated PR: Update README",
                "body": "This pull request was automatically created by GitHub Actions.",
                "head": "update-readme",
                "base": "main"
              }'
